<div class="container-fluid mt-4">
    <h2 class="mb-4">Quản lý Truyện</h2>

    <!-- Thanh tìm kiếm và lọc - Cấu trúc lại cho tương thích hơn với Bootstrap 3/4 cơ bản -->
    <div class="row mb-3">
        <!-- Khung tìm kiếm tiêu đề/tác giả -->
        <div class="col-xs-12 col-sm-6 col-md-4">
            <div class="form-group"> <!-- Bootstrap 3/4 thường dùng form-group để nhóm label và input -->
                <label for="story-search-input">Tìm kiếm:</label>
                <input type="text" id="story-search-input" class="form-control" placeholder="Tìm kiếm theo tiêu đề, tác giả...">
            </div>
        </div>

        <!-- Khung lọc trạng thái -->
        <div class="col-xs-12 col-sm-6 col-md-3">
            <div class="form-group">
                <label for="story-status-filter">Trạng thái:</label>
                <select id="story-status-filter" class="form-control">
                    <option value="">Tất cả trạng thái</option>
                    <option value="writing">Đang viết</option>
                    <option value="complete">Hoàn thành</option>
                    <option value="blocked">Đã khóa</option>
                    <option value="approved">Đã duyệt</option>
                </select>
            </div>
        </div>

        <!-- Khung lọc thể loại -->
        <div class="col-xs-12 col-sm-6 col-md-3">
            <div class="form-group">
                <label for="story-category-filter">Thể loại:</label>
                <select id="story-category-filter" class="form-control">
                    <option value="">Tất cả thể loại</option>
                    <!-- Thể loại sẽ được tải động bằng JS -->
                </select>
            </div>
        </div>

        <!-- Nút tìm kiếm -->
        <div class="col-xs-12 col-sm-6 col-md-2">
            <!-- Thêm một chút padding-top hoặc margin-top để nút căn chỉnh với các input/select,
                 hoặc bọc nó trong một form-group rỗng nếu muốn dùng style consistent -->
            <div class="form-group d-flex align-items-end" style="height: 100%;">
                <button class="btn btn-primary btn-block mt-auto" onclick="searchAndFilterStories()">Tìm kiếm</button>
            </div>
            <!-- Nếu không có d-flex, align-items-end: -->
            <!-- <div style="margin-top: 25px;">
                <button class="btn btn-primary btn-block" onclick="searchAndFilterStories()">Tìm kiếm</button>
            </div> -->
        </div>
    </div>
    <!-- Thêm CSS tùy chỉnh nhỏ nếu cần để căn chỉnh nút "Tìm kiếm" -->
    <style>
        @media (min-width: 992px) { /* Cho màn hình desktop trở lên */
            .row.mb-3 .col-md-2 .form-group {
                display: flex;
                align-items: flex-end; /* Căn chỉnh nút ở dưới cùng */
                height: 100%; /* Để form-group chiếm toàn bộ chiều cao của cột */
            }
            .row.mb-3 .col-md-2 .btn {
                width: 100%; /* Đảm bảo nút chiếm toàn bộ chiều rộng có thể */
            }
        }
        @media (max-width: 767.98px) { /* Trên các màn hình nhỏ hơn (mobile/tablet) */
            .row.mb-3 .form-group {
                margin-bottom: 10px; /* Thêm khoảng cách giữa các trường trên mobile */
            }
            .row.mb-3 .col-xs-12 .btn {
                margin-top: 10px; /* Thêm khoảng cách cho nút trên mobile */
            }
        }
    </style>


    <!-- Bảng hiển thị danh sách truyện -->
    <div class="table-responsive">
        <table class="table table-hover table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>ID</th>
                    <th>Ảnh bìa</th>
                    <th>Tiêu đề</th>
                    <th>Tác giả</th>
                    <th>Thể loại</th>
                    <th>Trạng thái</th>
                    <th>Số chương</th>
                    <th>Ngày tạo</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody id="story-table-body">
                <!-- Dữ liệu truyện sẽ được tải động bằng JS -->
                <tr><td colspan="9">Đang tải truyện...</td></tr>
            </tbody>
        </table>
    </div>

    <!-- Phân trang -->
    <div id="story-pagination" class="mt-3 d-flex justify-content-center">
        <!-- Các nút phân trang sẽ được tạo động bằng JS -->
    </div>

<!-- Modal xem/sửa chi tiết truyện -->
<div class="modal fade" id="storyModal" tabindex="-1" role="dialog" aria-labelledby="storyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="storyModalLabel">Chi tiết Truyện</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="hideModal('storyModal')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="story-detail-form">
                    <input type="hidden" id="modalStoryId">
                    <div class="form-group">
                        <label for="modalStoryTitle">Tiêu đề:</label>
                        <input type="text" class="form-control" id="modalStoryTitle" readonly>
                    </div>
                    <div class="form-group">
                        <label for="modalAuthorUsername">Tác giả:</label>
                        <input type="text" class="form-control" id="modalAuthorUsername" readonly>
                    </div>
                    <div class="form-group">
                        <label for="modalDescription">Mô tả:</label>
                        <textarea class="form-control" id="modalDescription" rows="5" readonly></textarea>
                    </div>
                    <div class="form-group">
                        <label for="modalThumbnail">Ảnh bìa:</label>
                        <img id="modalThumbnailImg" src="" alt="Thumbnail" class="img-fluid d-block mb-2" style="max-height: 150px;">
                        <input type="text" class="form-control" id="modalThumbnail" readonly>
                    </div>
                    <div class="form-group">
                        <label for="modalCategory">Thể loại:</label>
                        <!-- THAY ĐỔI TẠI ĐÂY: Dùng select thay vì input text readonly -->
                        <select class="form-control" id="modalCategory">
                            <!-- Options sẽ được điền động bằng JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modalStatus">Trạng thái:</label>
                        <select class="form-control" id="modalStatus">
                            <option value="writing">Đang viết</option>
                            <option value="complete">Hoàn thành</option>
                            <option value="blocked">Bị khóa</option>
                            <option value="approved">Đã duyệt</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modalCreatedAt">Ngày tạo:</label>
                        <input type="text" class="form-control" id="modalCreatedAt" readonly>
                    </div>

                    <h6 class="mt-4">Danh sách Chương:</h6>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead class="thead-light">
                                <tr>
                                    <th>Chương số</th>
                                    <th>Tiêu đề chương</th>
                                    <th>Ngày tạo</th>
                                </tr>
                            </thead>
                            <tbody id="modalChaptersList">
                                <!-- Chương sẽ được tải động bằng JS -->
                            </tbody>
                        </table>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="hideModal('storyModal')">Đóng</button>
                <button type="button" class="btn btn-warning" id="saveStoryChangesBtn">Lưu thay đổi</button> <!-- Đổi text button cho rõ ràng hơn -->
                <button type="button" class="btn btn-danger" id="deleteStoryBtn">Xóa Truyện</button>
            </div>
        </div>
    </div>
</div>